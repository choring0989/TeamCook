<!DOCTYPE html>
<html lang="zxx">

<head>
    <meta charset="UTF-8">
    <meta name="description" content="Yoga Studio Template">
    <meta name="keywords" content="Yoga, unica, creative, html">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Team Cook!</title>

    <!-- Google Font -->
    <link href="https://fonts.googleapis.com/css?family=PT+Sans:400,700&display=swap" rel="stylesheet">

    <!-- Css Styles -->
    <link rel="stylesheet" href="css/bootstrap.min.css" type="text/css">
    <link rel="stylesheet" href="css/font-awesome.min.css" type="text/css">
    <link rel="stylesheet" href="css/nice-select.css" type="text/css">
    <link rel="stylesheet" href="css/slicknav.min.css" type="text/css">
    <link rel="stylesheet" href="css/style.css" type="text/css">
</head>

<body>
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/6.2.0/firebase-app.js"></script>

    <!-- Add Firebase products that you want to use -->
    <script src="https://www.gstatic.com/firebasejs/6.2.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/6.2.0/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/3.1.0/firebase-database.js"></script>

    <!-- Page Preloder -->
    <div id="preloder">
        <div class="loader"></div>
    </div>
    <!-- Header Section Begin -->
    <header class="header-section">
        <div class="row container-fluid" style="flex-wrap:nowrap; margin-left:0px;">
            <div class="logo">
                <a href="./index.html"><img src="img/little-logo.png" alt=""></a>
            </div>
            <div class="nav-right nav-custom">
                <form action="search.html" class="filter-search" method="GET">
                    <input type="text" placeholder="Search recipe" class="search-box" name="input" />
                    <button type="submit" id="search-btn"><i class="fa fa-search"></i></button>
                </form>
            </div>
            <div id="mobile-menu-wrap" style="overflow: hidden; margin-right: 4px; margin-top: 20px;">
            </div>
            <div class="nav-menu">
                <nav class="main-menu mobile-menu">
                    <ul>
                        <li class="active"><a href="#">Home</a></li>
                        <li><a href="#">Category</a>
                            <ul class="sub-menu">
                                <li><a href="search.html?input=Dinner">Dinner</a></li>
                                <li><a href="search.html?input=Sweet">Sweet</a></li>
                                <li><a href="search.html?input=Noodle">Noodle</a></li>
                            </ul>
                        </li>
                        <li><a href="all-recipes.html">All Rcps</a></li>
                        <li><a href="example-main.html">recommend</a></li>
                    </ul>
                </nav>
            </div>
        </div>
    </header>
    <!-- Header End -->

    <!-- Hero Search Section Begin -->
    <div class="hero-search set-bg" data-setbg="img/search-bg.jpg"
        style="width: 85.7%; margin: auto; margin-bottom: 30px;">
        <div class="container">
            <div class="filter-table">
                <h2 id="search-result-header">loading...</h2>
            </div>
        </div>
    </div>
    <!-- Hero Search Section End -->

    <!-- Single Recipe Section Begin -->
    <section class="single-page-recipe spad" style="margin: 0px 40px 0px 40px;">
        <div class="recipe-top">
            <div class="container-fluid">
                <div class="recipe-title">
                    <span>By
                        <a href="#">temp Author</a>
                    </span>
                    <span>| temp 23 Jun 2020</span>
                    <h2 id="name"></h2>
                </div>
                <img id="f_image" src="" alt="">
                <div btn-box>
                    <div class="recipe-btn2">
                        <a href="#">Press Control+D to bookmark</a>
                    </div>
                </div>
            </div>
            <div class="col-lg-5">
                <div class="ingredients-item">
                    <div class="ingredient-list">
                        <div class="list-item">
                            <h5>Ingredients</h5>
                            <div class="salad-list">
                                <h6 id="main">Main</h6>
                                <div id="list1"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="recipe-middle">
            <div class="calories">
                <div class="calo-title">
                    <h6>Total Calories</h6>
                    <span id="calor"></span>
                </div>
                <ul>
                    <li id="Ssize"></li>
                </ul>
            </div>
            <div class="nutrition-fact">
                <div class="nutri-title">
                    <h6>Nutrition Facts</h6>
                    <span id="Tsize"></span>
                </div>
                <ul>
                    <li id="fat"></li>
                    <li id="carb"></li>
                    <li id="prot"></li>
                </ul>
            </div>
        </div>
        <div class="container">
            <div class="row">
                <div class="col-lg-7">
                    <div class="recipe-right">
                        <div class="instruction-list">
                            <h3>Instructions</h3>
                            <div id="cok_order"></div>
                        </div>
                    </div>
                </div>
                <div class="col-lg-5">
                    <div class="ingredients-item">
                        <div class="ingredient-list">
                            <div class="list-item">
                                <h5>What is the tag of this recipe?</h5>
                                <div class="salad-list">
                                    <h6>Related TAGS</h6>
                                    <ul id="tags">
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="recipe-right" style="min-width: 700px;">
                    <div class="notes">
                        <h5>Tip/Caution</h5><br>
                        <div class="notes-item">
                            <span>i</span>
                            <p id="tips"></p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <!-- Single Recipe Section End -->

    <script>
        var firebaseConfig = {
            apiKey: "AIzaSyA_YlPiT7ZSrxRlYdfDzVH4nG0MspsdHts",
            authDomain: "team-cook.firebaseapp.com",
            databaseURL: "https://team-cook.firebaseio.com",
            projectId: "team-cook",
            storageBucket: "team-cook.appspot.com",
            messagingSenderId: "648033990336",
            appId: "1:648033990336:web:006565376777c3cbab9f25",
            measurementId: "G-0713Y1K789"
        };

        // Firebase 활성화
        firebase.initializeApp(firebaseConfig);

        // 현재 URL 가져오기
        var url = location.href;
        // get 파라미터 값을 가져올 수 있는 ? 를 기점으로 slice 한 후 split 으로 나눔
        var key = (url.slice(url.indexOf('?') + 1, url.length)).split('=')[1];
        console.log(key);

        //레시피 가져오기
        var menu_ref = firebase.database().ref("recipes/" + key);
        menu_ref.once("value").then(function (data) {
            console.log(data.val().name);

            var menu_name = document.getElementById("name"); //메뉴이름
            menu_name.innerHTML = data.val().name;
            document.getElementById('search-result-header').innerHTML = data.val().name;

            //메뉴 이미지
            var fimage = document.getElementById("f_image");
            fimage.src = data.val().img_Orign;

            //재료목록
            ingredients = data.val().Ingredients[0];
            var str = "<ul>"
            ingredients.forEach(function (ingre) {
                str += "<li>" + ingre + "</li>";
            });
            str += "</ul>";
            document.getElementById("list1").innerHTML = str;

            //칼로리 등
            var calor = document.getElementById("calor");
            calor.innerHTML = data.val().Nutr[0];

            var calor = document.getElementById("Ssize");
            calor.innerHTML = data.val().Nutr[5];

            var calor = document.getElementById("Tsize");
            calor.innerHTML = data.val().Nutr[1];

            var calor = document.getElementById("fat");
            calor.innerHTML = data.val().Nutr[2];

            var calor = document.getElementById("carb");
            calor.innerHTML = data.val().Nutr[3];

            var calor = document.getElementById("prot");
            calor.innerHTML = data.val().Nutr[4];
            //요리순서
            cooking_order = data.val().cooking_order[0];
            var str2 = "<ul>"
            var r_num = 0;
            cooking_order.forEach(function (odnum) {
                r_num++;
                str2 += "<li> \[" + r_num + "\] " + odnum + "</li>";
            });
            str2 += "</ul>";
            document.getElementById("cok_order").innerHTML = str2;

            //관련태그
            var n = data.val().tags;

            tags = Object.keys(n);//여기 고쳐놨어요!
            var str3 = "<ul>"
            tags.forEach(function (tag) {
                str3 += "<li>" + tag + "</li>";
            });
            str3 += "</ul>";
            document.getElementById("tags").innerHTML = str3;

            // 팁 출력
            var tips = document.getElementById("tips");
            tips.innerHTML = data.val().tip;
        });
    </script>

    <!-- Similar Recipe Section Begin -->
    <section class="similar-recipe spad">
        <h3>Recent Recipes</h3>
        <div class="container">
            <div class="row"></div>
        </div>
    </section>
    <!-- Similar Recipe Section End -->

    <script>
        var addingSectionTop = document.getElementsByClassName("similar-recipe spad")[0];
        var addingSectionRow = addingSectionTop.getElementsByClassName("row");
        accessDB();

        function accessDB() {
            var recentPostsRef = firebase.database().ref('recipes/').orderByKey().limitToLast(3);
            recentPostsRef.on('child_added', function (data) {
                var col = document.createElement("div");
                col.setAttribute("class", "col-lg-3 col-md-6");
                var item = document.createElement('div');
                item.setAttribute('class', 'similar-item');
                var a = document.createElement("a");
                var href = "recipe.html?key=" + data.key;
                a.setAttribute("href", href);

                var preview = document.createElement("img");
                preview.setAttribute("src", data.val().img);

                var smrtext = document.createElement("div");
                smrtext.setAttribute("class", "ri-similar-text");

                //***** 계층 관계대로 붙여주세요
                addingSectionRow[0].appendChild(col).appendChild(item).appendChild(a);
                a.appendChild(preview);
                item.appendChild(smrtext)
            });
        }
    </script>

    <!-- Footer Section Begin -->
    <footer class="footer-section">
        <div class="container">
            <div class="row">
                <div class="col-lg-5">
                    <div class="fs-left">
                        <div class="logo">
                            <a href="./index.html">
                                <img src="img/footer-logo.png" alt="">
                            </a>
                        </div>
                        <p>2020 Gachon University Web Programming Term Project.<br>
                            Contributors: Kim Sangmin / Ko Haesol / Park Taehwan / Lee Ji An
                        </p>
                    </div>
                </div>
                <div class="col-lg-6 offset-lg-1">
                    <form action="#" class="subscribe-form">
                        <h3>Subscribe to our newsletter</h3>
                        <input type="email" placeholder="Your e-mail">
                        <button type="submit">Subscribe</button>
                    </form>
                    <div class="social-links">
                        <a href="#"><i class="fa fa-instagram"></i><span>Instagram</span></a>
                        <a href="#"><i class="fa fa-pinterest"></i><span>Pinterest</span></a>
                        <a href="#"><i class="fa fa-facebook"></i><span>Facebook</span></a>
                        <a href="#"><i class="fa fa-twitter"></i><span>Twitter</span></a>
                        <a href="#"><i class="fa fa-youtube"></i><span>Youtube</span></a>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-lg-12">
                    <div class="copyright-text">
                        <!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. -->
                        Copyright &copy;
                        <script>document.write(new Date().getFullYear());</script> All rights reserved | This template
                        is made with <i class="fa fa-heart-o" aria-hidden="true"></i> by <a href="https://colorlib.com"
                            target="_blank">Colorlib</a>
                        <!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. -->
                    </div>
                </div>
            </div>
        </div>
    </footer>
    <!-- Footer Section End -->
    <!-- Search model -->
    <div class="search-model">
        <div class="h-100 d-flex align-items-center justify-content-center">
            <div class="search-close-switch">+</div>
            <form class="search-model-form">
                <input type="text" id="search-input" placeholder="Search here.....">
            </form>
        </div>
    </div>
    <!-- Search model end -->

    <!-- Js Plugins -->
    <script src="js/jquery-3.3.1.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/jquery.slicknav.js"></script>
    <script src="js/jquery.nice-select.min.js"></script>
    <script src="js/mixitup.min.js"></script>
    <script src="js/main.js"></script>
</body>

</html>